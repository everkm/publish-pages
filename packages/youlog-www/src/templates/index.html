{% extends "_everkm/layout.html" %}
{% import "_everkm/blocks.html" as blocks %}
{% import "_everkm/blocks/nav.html" as nav_blocks %}


{% block body %}
<div class="block-container space-y-6">
    <h1 class="text-4xl font-extrabold mt-6"><a href="{{base_url()}}/">{{__cfg.site.name}}</a></h1>

    {% set page_no =__qs.page | default(value=1) | int %}
    {% set start = (page_no - 1) * 5 %}
    {% set end = start + 5 %}
    {% set items = posts(dir="/", recursive=true) %}
    {% set page_count = script(content="Math.ceil(args.val)", val = items | length / 5 ) %}

    {% if page_no < 2 and post_exist(path="/_page/home.md") %}
        {% set doc = post_detail(path="/_page/home.md") %}
        <div class="yb-content2">
        {{doc.content_html | safe}}
        </div>
    {% endif %}


    {% set dt = "" %}
    {% for doc in items | slice(start=start, end=end) %}
        {% set cur_dt = doc.date | date(format="%Y-%m-%d") %}
        {% if dt != cur_dt %}
            {% set_global dt = cur_dt %}
            <div class="text-[#2f353e] font-semibold text-[95%] number">{{dt}}</div>
        {% endif %}
    
        <div class="space-y-2 pl-[1em]">
            <h2 class="text-2xl">
                <a class="text-[#005b99] font-medium" href="{{doc.url_path | safe}}?path={{doc.path|urlencode_strict}}&__tpl={{"detail.html"|urlencode_strict}}" target="_blank">
                {{doc.title}}
                </a>
            </h2>
        </div>
    {% endfor %}

    {% if page_count > 1 %}
    <div class="space-x-6 flex !mt-10">
        {% if page_no > 1 %}
        <div class="flex items-center space-x-1">
            {% if page_no == 2 %}
            {{nav_blocks::arrow_left()}}
            <a href="index.html">上一页</a>
            {% elif page_no > 2 %}
            {{nav_blocks::arrow_left()}}
            <a href="index.p{{page_no-1}}.html?page={{page_no-1}}">上一页</a>
            {% endif %}
        </div>
        {% endif %}

        <div class="">{{page_no}} / {{page_count}}</div>
            
        {% if items | length > end %}
        <div class="flex items-center space-x-1">
            <a href="index.p{{page_no+1}}.html?page={{page_no+1}}">下一页</a>
            {{nav_blocks::arrow_right()}}
        </div>
        {% endif %}
    </div>
    {% endif %}

</div>
{% endblock body %}